---
description: 根据用户需求为当前功能生成定制检查表。
---

## 检查表定位：“英文规格的单元测试”

**关键概念**：检查表就是**需求写作的单元测试**——用来验证某一领域的需求在质量、清晰度与完备性上是否达标。

**它不是用来做实现验证/测试的**：

- ❌ 不是 “确认按钮能被点击”
- ❌ 不是 “测试错误处理是否生效”
- ❌ 不是 “确认 API 返回 200”
- ❌ 不是对照规格检查代码实现

**它用于验证需求质量**：

- ✅ “是否为所有卡片类型定义了视觉层级要求？”（完整性）
- ✅ “‘突出展示’ 是否用具体尺寸/位置量化？”（清晰度）
- ✅ “所有交互元素的 hover 状态要求是否一致？”（一致性）
- ✅ “是否为键盘导航定义了无障碍要求？”（覆盖度）
- ✅ “规格是否说明 Logo 图片加载失败时如何处理？”（边界场景）

**类比**：如果规格是用英语写的代码，检查表就是它的单元测试套件。要测试的是“需求写得是否好、是否完整、是否无歧义、是否可直接进入实现”，而不是“实现是否好用”。

## 用户输入

```text
$ARGUMENTS
```

如有输入，你**必须**先参考用户输入后再继续。

## 执行步骤

1. **环境准备**：在仓库根目录运行 `.specify/scripts/bash/check-prerequisites.sh --json`，解析 JSON 中的 FEATURE_DIR 与 AVAILABLE_DOCS。
   - 所有路径必须是绝对路径。
   - 参数含单引号（如 "I'm Groot"）时需写成 `I'\''m Groot`，或改用双引号。

2. **动态澄清意图**：最多提出 3 个初始澄清问题（不可用题库预设）。它们必须：
   - 基于用户描述 + spec/plan/tasks 中提取的信号生成
   - 只询问会实质影响检查表内容的信息
   - 如 `$ARGUMENTS` 已明确某点，则跳过对应问题
   - “精准”优先于“面面俱到”

   生成算法：
   1. 提取信号：领域关键词（auth、latency、UX、API 等）、风险词（critical、must、compliance）、干系人线索（QA、review、安全团队）、明确交付物（a11y、rollback、contracts）。
   2. 将信号聚成最多 4 个关注群组并按相关度排序。
   3. 判断目标受众与时机（作者、评审、QA、发布），若未说明则推断。
   4. 识别缺失维度：范围、深度/严谨度、风险重心、排除边界、可量化验收准则。
   5. 从下列原型中构造问题：
      - 范围收窄：“是否需要包含与 X/Y 的集成触点，还是仅关注本地模块？”
      - 风险排序：“这些风险点中谁需要强制 gate 检查？”
      - 深度校准：“这是轻量 pre-commit 自检还是正式发布 gate？”
      - 受众设定：“仅供作者使用还是 PR 评审也会用？”
      - 排除边界：“本轮是否明确排除性能调优项？”
      - 场景缺口：“未检测到恢复流程——回滚/部分失败场景是否在范围内？”

   问题格式要求：
   - 若提供选项，使用表格 `Option | Candidate | Why It Matters`
   - 最多 A–E 选项；若自由回答更清晰则不使用表格
   - 不要让用户重复已给信息
   - 禁止凭空猜测，若不确定就直接问 “X 是否在范围内？”

   若无法交互，默认值：
   - 深度：Standard
   - 受众：涉及代码则为 Reviewer（PR），否则为 Author
   - 关注焦点：前 2 个相关度最高的聚类

   输出 Q1/Q2/Q3。若答复后仍有 ≥2 个场景类别（主/备/异常/恢复/非功能）不清晰，可追加最多 2 个 follow-up（Q4/Q5），并给出一句理由（如 “恢复路径风险未解决”）。总问题数 ≤5；若用户拒绝继续，立即停止。

3. **理解用户诉求**：结合 `$ARGUMENTS` 与澄清答案：
   - 萃取检查表主题（security、review、deploy、ux 等）
   - 汇总用户明确要求必须包含的条目
   - 将关注焦点映射到分类框架
   - 结合 spec/plan/tasks 补足缺失上下文（禁止臆造）

4. **加载功能上下文**：从 FEATURE_DIR 读取：
   - spec.md：功能需求与范围
   - plan.md（如存在）：技术细节与依赖
   - tasks.md（如存在）：实施任务

   **加载策略**：
   - 仅取与当前关注点相关的段落，避免整文件倾倒
   - 长段落优先总结为简明要点
   - 采用渐进披露：仅在发现缺口时追加读取
   - 如源文档较大，用中间摘要替代原文粘贴

5. **生成检查表** —— “英文规格的单元测试”：
   - 若 `FEATURE_DIR/checklists/` 不存在则创建
   - 选择短而描述性的文件名：`[domain].md`（如 `ux.md`、`api.md`、`security.md`）
   - 若同名文件已存在则追加，否则创建新文件
   - 条目从 CHK001 开始全局递增
   - 每次 `/speckit.checklist` 调用都要生成一个全新的文件（不要覆盖已有文件）

   **核心原则：测试需求，不测实现**。每个条目都需评估需求在以下维度的表现：
   - **Completeness**：是否缺少必要需求
   - **Clarity**：是否清晰且可具体指认
   - **Consistency**：需求之间是否一致
   - **Measurability**：是否可以客观验证
   - **Coverage**：是否覆盖所有场景/边界

   **分类结构**（按需求质量维度分组）：
   - Requirement Completeness
   - Requirement Clarity
   - Requirement Consistency
   - Acceptance Criteria Quality
   - Scenario Coverage
   - Edge Case Coverage
   - Non-Functional Requirements
   - Dependencies & Assumptions
   - Ambiguities & Conflicts

   **撰写要点——“英文单测”**：

   ❌ 错误（测试实现）：
   - “验证落地页展示 3 个卡片”
   - “测试桌面端 hover 正常”
   - “确认点击 Logo 返回首页”

   ✅ 正确（测试需求质量）：
   - “是否明确规定了精选卡片数量与布局？[Completeness]”
   - “‘突出’ 是否给出具体尺寸/位置？[Clarity]”
   - “所有交互元素的 hover 要求是否一致？[Consistency]”
   - “是否为键盘交互定义了无障碍要求？[Coverage]”
   - “Logo 图片加载失败时的处理是否写明？[Edge Case]”
   - “异步数据加载是否定义了 Loading 状态？[Completeness]”
   - “冲突元素的视觉层级是否有明确标准？[Clarity]”

   **条目结构**：
   - 以提问形式聚焦需求本身
   - 关注规格中“写了/没写”的内容
   - 以方括号注明质量维度，如 `[Clarity]`
   - 若引用已有要求，注明 `[Spec §X.Y]`
   - 若检查缺失项，则标记 `[Gap]`

   **按质量维度举例**：

   Completeness：
   - “是否定义了所有 API 失败模式的错误处理要求？[Gap]”
   - “是否为全部交互元素明确无障碍要求？[Completeness]”
   - “响应式布局是否写明移动端断点？[Gap]”

   Clarity：
   - “‘快速加载’ 是否量化为具体时间？[Clarity, Spec §NFR-2]”
   - “‘相关剧集’ 的选择标准是否明确？[Clarity, Spec §FR-5]”
   - “‘突出’ 是否用可度量属性定义？[Ambiguity, Spec §FR-4]”

   Consistency：
   - “导航要求在所有页面是否一致？[Consistency, Spec §FR-10]”
   - “卡片组件在首页与详情页的要求是否一致？[Consistency]”

   Coverage：
   - “是否定义了零数据状态的需求？[Coverage, Edge Case]”
   - “是否覆盖并发交互场景？[Coverage, Gap]”
   - “部分数据加载失败时的需求是否写明？[Coverage, Exception Flow]”

   Measurability：
   - “视觉层级要求是否可度量/可测试？[Acceptance Criteria, Spec §FR-1]”
   - “‘平衡视觉权重’ 能否客观验证？[Measurability, Spec §FR-2]”

   **场景分类与覆盖（聚焦需求质量）**：
   - 检查是否存在：主流程、替代流程、异常/错误、恢复、非功能场景
   - 各场景都需问：“此类场景的需求是否完整、清晰、一致？”
   - 如缺少某类：“该类场景需求是刻意排除还是遗漏？[Gap]”
   - 有状态变更时别忘了弹性/回滚：“迁移失败是否定义回滚？[Gap]”

   **可追溯性要求**：
   - 至少 80% 条目需包含追溯引用
   - 形式：`[Spec §X.Y]`、`[Gap]`、`[Ambiguity]`、`[Conflict]`、`[Assumption]`
   - 若缺少 ID 体系，可加入 “是否建立需求与验收标准的 ID 体系？[Traceability]”

   **暴露与解决问题**（指向需求本身）：
   - 模糊： “'fast' 是否有具体指标？[Ambiguity, Spec §NFR-1]”
   - 冲突： “§FR-10 与 §FR-10a 的导航要求是否冲突？[Conflict]”
   - 假设： “'播客 API 永远可用' 的假设是否已验证？[Assumption]”
   - 依赖： “是否记录外部播客 API 的要求？[Dependency, Gap]”
   - 定义缺失： “‘视觉层级’ 是否给出可度量定义？[Gap]”

   **内容收敛**：
   - 候选条目 >40 时，按风险/影响优先
   - 合并重复度高的条目
   - 若 >5 个低影响边界场景，可整合成 “是否覆盖 X/Y/Z 边界？[Coverage]”

   **🚫 严禁**（否则沦为实现测试）：
   - 以 “Verify/Test/Confirm/Check” 开头并描述实现行为
   - 引用代码执行、用户动作、系统行为
   - “显示正确”“工作正常”“如预期运行”
   - “点击/跳转/渲染/加载/执行” 等实现词
   - 测试用例、测试计划、QA 步骤
   - 具体实现细节（框架、API、算法）

   **✅ 必需模式**（聚焦需求质量）：
   - “是否为 [场景] 定义了 [需求类型]？”
   - “‘模糊词’ 是否以具体标准量化？”
   - “A 节与 B 节的需求是否一致？”
   - “[需求] 能否客观验证？”
   - “是否覆盖 [边界/场景] 的需求？”
   - “规格是否定义了 [缺失要素]？”

6. **结构参考**：生成检查表时遵循 `.specify/templates/checklist-template.md` 的标题、元数据、分类与 ID 格式。如模板缺失，则使用：一级标题 + 目的/创建日期 + `##` 分类标题 + `- [ ] CHK### ...` 条目，CHK 号全局递增。

7. **报告**：输出新建文件的完整路径与条目总数，并提醒用户每次运行都会生成新文件。摘要应包含：
   - 本次关注领域
   - 深度级别
   - 目标受众/时机
   - 已纳入的用户必需项

**重要提示**：每次 `/speckit.checklist` 会创建一个以短描述命名的文件（若无同名文件）。这样可以：

- 在 `checklists/` 中保存多份不同主题的检查表（如 `ux.md`、`test.md`、`security.md`）
- 通过文件名快速了解用途
- 方便整理与导航

如不再需要，请清理过期检查表以避免噪音。

## 检查表类型示例

**UX 需求质量**：`ux.md`

示例条目：

- “是否用可度量标准定义了视觉层级？[Clarity, Spec §FR-1]”
- “UI 元素数量与位置是否明确？[Completeness, Spec §FR-1]”
- “交互状态（hover/focus/active）要求是否一致？[Consistency]”
- “所有交互元素是否写明无障碍要求？[Coverage, Gap]”
- “图像失败时的兜底行为是否定义？[Edge Case, Gap]”
- “‘突出展示’ 能否客观测量？[Measurability, Spec §FR-4]”

**API 需求质量**：`api.md`

- “是否定义了失败场景的错误响应结构？[Completeness]”
- “限流要求是否给出具体阈值？[Clarity]”
- “所有端点的认证要求是否一致？[Consistency]”
- “外部依赖的重试/超时要求是否写明？[Coverage, Gap]”
- “是否记录版本策略？[Gap]”

**性能需求质量**：`performance.md`

- “性能指标是否量化？[Clarity]”
- “所有关键用户旅程是否定义性能目标？[Coverage]”
- “不同负载下的性能要求是否写明？[Completeness]”
- “性能需求能否客观测试？[Measurability]”
- “高负载降级策略是否定义？[Edge Case, Gap]”

**安全需求质量**：`security.md`

- “所有受保护资源是否定义了认证要求？[Coverage]”
- “敏感数据的防护要求是否完整？[Completeness]”
- “威胁模型是否记录并与需求对齐？[Traceability]”
- “安全需求是否满足合规义务？[Consistency]”
- “安全失败/泄露响应是否定义？[Gap, Exception Flow]”

## 反例：不要这么写

**❌ 错误（测试实现）**

```markdown
- [ ] CHK001 - 验证落地页展示 3 个剧集卡片 [Spec §FR-001]
- [ ] CHK002 - 测试桌面端 hover 状态表现正常 [Spec §FR-003]
- [ ] CHK003 - 确认点击 Logo 会跳转首页 [Spec §FR-010]
- [ ] CHK004 - 检查相关推荐区显示 3-5 项 [Spec §FR-005]
```

**✅ 正确（测试需求质量）**

```markdown
- [ ] CHK001 - 是否明确写出了精选剧集的数量与布局？[Completeness, Spec §FR-001]
- [ ] CHK002 - 所有交互元素的 hover 要求是否保持一致？[Consistency, Spec §FR-003]
- [ ] CHK003 - 所有可点击品牌元素的导航需求是否清楚？[Clarity, Spec §FR-010]
- [ ] CHK004 - 相关推荐的筛选标准是否被记录？[Gap, Spec §FR-005]
- [ ] CHK005 - 异步剧集数据的 Loading 要求是否写明？[Gap]
- [ ] CHK006 - “视觉层级” 要求能否客观量测？[Measurability, Spec §FR-001]
```

**差异要点**：
- 错误示例在检查“系统是否实现了 X”
- 正确示例在验证“规格是否清楚写了 X”
- 错误示例关注行为验证
- 正确示例关注需求质量
- 错误示例问 “做到了吗？”
- 正确示例问 “写清楚了吗？”
