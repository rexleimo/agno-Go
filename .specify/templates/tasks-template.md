---

description: "功能实施任务模板"
---

# 任务清单：[FEATURE NAME]

**输入**：`/specs/[###-feature-name]/` 中的设计文档  
**前置**：plan.md（必需）、spec.md（用户故事必需）、research.md、data-model.md、contracts/

**测试**：示例中包含测试任务。测试是可选项——仅当功能规格明确要求或用户主动请求时才加入。

**覆盖率**：所有功能必须交付匹配的单元测试，Go 侧 `go test ./...` 必须可运行并产出 ≥85% 的覆盖率；如有 Python 对照测试或基准脚本，任务需要明确其路径与执行命令。

**栈约束**：所有任务必须指向真实路径，覆盖 Python 参考实现（`agno/libs/agno/agno/` 与相关 tests）、Go 实现（例如 `go/agent`、`go/workflow` 等）、必要的脚手架脚本与配置；避免引用不存在的前端或基础设施目录，并确保最终 Go 交付物不在运行时调用 Python（跨语言脚本只能作为 `scripts/` 或测试工具）。

**组织方式**：任务按用户故事或迁移单元分组，确保每个单元都能独立实现与测试，并清晰标注其对应的 Python 模块与 Go 包。

## 格式：`[ID] [P?] [Unit] 描述`

- **[P]**：可并行执行（不同文件，且无依赖）
- **[Unit]**：所属迁移单元或用户故事（如 U1、U2、US1、US2）
- 描述中必须包含精确文件路径

## 路径约定

- **Python 参考实现**：`agno/libs/agno/agno/` 下的核心模块（如 `agent`、`team`、`workflow`、`memory`、`knowledge`、`models`、`tools`、`os` 等），以及相应的 tests 目录。
- **Go 实现**：集中在约定的 Go 根目录（例如 `go/`），按模块或领域划分子包（如 `go/agent`、`go/workflow` 等），并通过 `go.mod` 管理依赖。
- **测试与工具**：Go 侧 `*_test.go` 文件、基准测试和辅助脚本（如用于对照测试的 Python/Go 桥接脚本），需要在任务中写明路径和执行命令。
- **文档与脚本**：README、Cookbook、迁移说明文档以及用于本地开发的脚本（例如 `scripts/*.sh` 或等价工具）；若文档中描述了 Python 与 Go 的支持矩阵，任务需确保与实际实现一致。

下文示例以上述结构为参考，实际交付时请替换为本仓库真实路径。

<!-- 
  ============================================================================
  重要：以下任务仅作示例。
  /speckit.tasks 必须替换为基于以下信息生成的真实任务：
  - spec.md 中带优先级的用户故事（P1、P2、P3...）
  - plan.md 描述的功能需求
  - data-model.md 中的实体
  - contracts/ 中的端点
  任务必须按迁移单元或用户故事组织，以便：
  - 独立实现
  - 独立测试
  - 按 MVP 增量交付
  不要在最终 tasks.md 中保留这些示例。
  ============================================================================
-->

## Phase 1: Setup（共享基础设施）

**目的**：为 Python–Go 迁移搭建基础设施，包括 Go module、测试框架与最小对照测试环境。

- [ ] T001 在仓库中初始化 Go module（`go.mod`），并创建用于迁移的基础目录结构（例如 `go/agent`、`go/workflow` 等）。
- [ ] T002 配置统一的 Go 开发工具链（如 `golangci-lint`、`gofumpt`），并提供脚本或 Make 目标执行 `go test ./...` 与静态检查。
- [ ] T003 [P] 搭建最小的跨语言对照测试环境（例如通过 CLI、JSON 文件或 gRPC 调用 Python 实现），以便比较 Go 与 Python 的行为。
- [ ] T004 [P] 在 `specs/` 中创建或更新用于迁移的规格与计划，明确首批迁移模块（例如 `agent`、`models` 或 `workflow`）及其优先级。

---

## Phase 2: Foundational（阻塞性前置）

**目的**：为首批迁移模块准备稳定的 Go 包结构、公共抽象和测试基线，解除后续迁移任务阻塞。

**⚠️ 关键**：在此阶段完成前，禁止开始具体模块迁移任务。

示例（按项目调整）：

- [ ] T008 为 Go 侧定义核心公共抽象（例如 Agent 接口、Tool 接口、Workflow 节点结构），并在合适的包中暴露。
- [ ] T009 [P] 在 Go 侧编写基础测试工具与测试数据生成函数，便于在多个模块中重用。
- [ ] T010 [P] 分析 Python 侧的错误模型与日志字段，为 Go 定义统一的错误类型与日志结构。
- [ ] T011 建立最小的性能基线（例如针对简单 Agent 调用的 benchmark），记录当前 Python 与 Go 实现的对比数据。

---

## Phase 3: 迁移单元 1 - [模块名]（优先级：P1）

**目标**：迁移首个关键模块（例如 Agent 核心或 Workflow 内核），建立 Python–Go 行为对齐的标杆。

**独立测试**：应能在仅依赖该模块的情况下，对 Go 实现进行单独测试与对照测试。

### 迁移单元 1 的测试（可选）⚠️

- [ ] T012 [P] [U1] 在 Go 侧为该模块编写单元测试（`*_test.go`），覆盖主要路径与边界条件。
- [ ] T013 [P] [U1] 设计并实现对照测试：对相同输入调用 Python 与 Go 实现，比对输出或事件序列。

### 迁移单元 1 的实现

- [ ] T014 [P] [U1] 在 Go 包中实现该模块的核心数据结构与接口（如 Agent、Tool、Workflow 节点等）。
- [ ] T015 [U1] 将实现接入基础抽象（如公共错误类型、日志与配置），并确保与 Python 行为对齐。
- [ ] T016 [U1] 如有需要，在 Python 项目中补充或校正测试，以澄清行为边界，并记录在文档中。

**检查点**：迁移单元 1 可独立测试，且对照测试通过。

---

## Phase 4: 迁移单元 2 - [模块名]（优先级：P2）

**目标**：迁移第二个关键模块或在首个迁移单元之上扩展能力。

**独立测试**：仍应保持可以针对该模块进行单独测试与对照测试。

### 迁移单元 2 的测试（可选）⚠️

- [ ] T019 [P] [U2] 在 Go 侧为该模块编写单元测试，并扩展对照测试覆盖新的行为。

### 迁移单元 2 的实现

- [ ] T021 [P] [U2] 在 Go 包中实现或扩展该模块的功能，保持与 Python 行为对齐。
- [ ] T022 [U2] 根据需要更新 Python 测试或文档，避免对行为理解产生偏差。

**检查点**：迁移单元 1 与 2 均可独立运行并通过对照测试。

---

## Phase 5: 迁移单元 3 - [模块名]（优先级：P3）

**目标**：迁移优先级较低但仍重要的模块，补齐整体能力。

**独立测试**：保持可以单独测试与对照测试。

### 迁移单元 3 的测试（可选）⚠️

- [ ] T034 [P] [U3] 在 Go 侧为该模块编写单元测试，并纳入对照测试矩阵。

### 迁移单元 3 的实现

- [ ] T036 [P] [U3] 在 Go 包中完成该模块的实现或重构。
- [ ] T037 [U3] 更新相关文档与迁移说明，确保用户理解 Python 与 Go 的支持情况。

**检查点**：所有迁移单元可独立运行并通过对照测试。

---

[如需更多迁移单元或用户故事，按同样模式扩展]

---

## Phase N: 抛光与跨领域事项

**目的**：影响多个迁移单元或全局行为的改进

- [ ] TXXX [P] 更新 README / Cookbooks / 迁移说明文档
- [ ] TXXX 代码清理与重构
- [ ] TXXX 全局性能优化与基准测试完善
- [ ] TXXX [P] 如需新增的单元测试（tests/unit/）
- [ ] TXXX 安全加固（如配置校验、敏感信息屏蔽）
- [ ] TXXX 验证 quickstart 场景或端到端示例

---

## 覆盖率 Gate（所有迁移单元完成后执行）

- [ ] T041 运行 `go test ./... -cover`（以及必要的基准测试），确保 Go 侧综合覆盖率 ≥85%，并上传覆盖率报告或构建工件。
- [ ] T042 在 README、迁移文档或 CI 注释中更新覆盖率、测试结果及关键性能指标，清晰呈现 Python 与 Go 的对比情况。

---

## 依赖与执行顺序

### 阶段依赖

- **Setup（Phase 1）**：无依赖，可立即开始
- **Foundational（Phase 2）**：依赖 Setup，阻塞后续迁移单元
- **迁移单元（Phase 3+）**：均依赖 Foundational 完成
  - 若人手充足，可并行
  - 否则按优先级顺序（P1→P2→P3）串行
- **Polish（最终阶段）**：依赖所有目标迁移单元完成

### 迁移单元依赖

- **U1 (P1)**：Foundational 后即可开始，无其他单元依赖
- **U2 (P2)**：在 U1 稳定的基础上扩展或可独立迁移，需明确与 U1 的依赖关系
- **U3 (P3)**：同上，可依赖前序单元的接口或抽象，但应保持可独立测试

### 单个迁移单元内的顺序

- 若有测试，必须“先写测试并看到失败”
- 先定义抽象与数据结构，再实现核心行为
- 实现完成后补充对照测试与基准测试
- 完成一个迁移单元后再进入下一个优先级

### 可并行机会

- 所有标记 [P] 的 Setup/Foundational 任务
- Foundational 完成后，各迁移单元可并行
- 同一迁移单元内标记 [P] 的测试/模型可并行
- 不同迁移单元可由不同成员并行推进

---

## 并行示例：迁移单元 1

```bash
# 若需要测试，可同时启动：
Task: "为 go/agent 编写 *_test.go 覆盖主要行为"
Task: "实现 Python 与 Go 对照测试脚本，比较输出差异"

# 可同时创建的模型：
Task: "在 go/agent 定义核心接口与状态结构"
Task: "在 go/agent/internal/ 实现具体行为，并接入日志与错误处理"
```

---

## 实施策略

### MVP 优先（仅交付迁移单元 1）

1. 完成 Phase 1
2. 完成 Phase 2（⚠️ 阻塞）
3. 完成 Phase 3（迁移单元 1）
4. **暂停并验证**：通过单元测试与对照测试验证迁移单元 1
5. 若准备好，可发布实验版本或内部演示

### 渐进式交付

1. Setup + Foundational → 基础完成
2. 加入 U1 → 独立测试与对照测试 → 部署/演示（MVP）
3. 加入 U2 → 独立测试与对照测试 → 部署/演示
4. 加入 U3 → 独立测试与对照测试 → 部署/演示
5. 每个迁移单元都能带来增量价值且不破坏前面成果

### 并行团队策略

1. 团队协作完成 Setup + Foundational
2. 基础完成后：
   - 开发者 A：U1
   - 开发者 B：U2
   - 开发者 C：U3
3. 各迁移单元独立完成并集成

---

## 备注

- 标记 [P] 表示不同文件、无依赖，可并行
- [Unit] 标签便于溯源到具体迁移单元或用户故事
- 每个迁移单元都应可独立完成与测试
- 若写测试，必须先失败后实现
- 建议每个任务或逻辑组完成后提交
- 任意检查点都可暂停做独立验证
- 避免模糊任务、同文件冲突、跨单元依赖打破独立性
