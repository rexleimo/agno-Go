
# Core Features & API 概要

このページでは、Agno-Go における主要な概念と、それらがランタイムの HTTP API とどのように対応しているかを高いレベルで説明します。Go の実装を読まずに「何ができるか」と「どのエンドポイントを叩けばよいか」を理解したい開発者を対象としています。

## コアコンセプト

### Agent（エージェント）

**Agent** は、あるタスクやプロダクト面に対して「どのように振る舞うか」を定義する構成です。具体的には：

- 名前と説明  
- デフォルトで使用するモデル（OpenAI、Gemini、Groq などのプロバイダ）  
- 利用を許可されたツールの一覧  
- 温度やルーティングポリシーなどのオプション設定  

Agent の作成・取得は `/agents` 系のエンドポイントで行います。

### Session（セッション）

**Session** は、ユーザー（またはシステム）と Agent の間の継続的な対話を表します：

- 常に 1 つの Agent に属する  
- `userId` と任意の `metadata`（チャネル、実験グループなど）を持つ  
- 一連のメッセージに対して安定したコンテキストを提供する  

セッションは `/agents/{agentId}/sessions` で作成します。

### Message（メッセージ）

**Message** は、セッション内の単一ターンの対話です：

- 役割（`user` や `assistant` など）を持つ  
- テキストコンテンツと、必要に応じてツール呼び出し情報を含む  
- `stream` クエリパラメータに応じて、単一の JSON かイベントストリームとして返される  

メッセージ送信には `/agents/{agentId}/sessions/{sessionId}/messages` を使用します。

### Tool（ツール）

ツールは、Agent が外部システム（HTTP API、データベース、検索など）を呼び出すためのインターフェースです。ランタイムは以下を提供します：

- Agent に対してツールを登録する手段  
- 特定のツールを有効化/無効化する手段  

ツールの ON/OFF は `/agents/{agentId}/tools/{toolName}` で切り替えます。

### Memory（メモリ）と状態

メモリは、セッションや対話をまたいで状態をどのように保持するかを表します。Agno-Go では：

- 短期的な会話状態は Session と Message に保持される  
- ユーザープロファイルやナレッジベースなどの長期的な状態は、設定されたストレージバックエンドに保存される  

実際に使用されるストレージ技術（インメモリ、Bolt、Badger など）は、環境変数と `config/default.yaml` によって決まり、その詳細は「Configuration & Security Practices」ページで説明されます。

### Provider（プロバイダ）

**Provider** は、OpenAI、Gemini、GLM4、OpenRouter、SiliconFlow、Cerebras、ModelScope、Groq、Ollama などのモデルバックエンドです。各プロバイダは：

- Go で共通の chat/embedding インターフェースを実装する  
- 認証およびエンドポイント設定のための特定の環境変数を必要とする  
- 非ストリーミングおよびストリーミングレスポンスをサポートする場合がある  

プロバイダごとの能力と設定項目は「プロバイダマトリクス」ページで確認できます。

## HTTP API サーフェス（ランタイム）

ランタイムは、上記の概念に対応する少数の HTTP エンドポイントを公開します。`contracts` ディレクトリ内の OpenAPI ドキュメントは完全な定義を提供しており、ここでは代表的なものだけを紹介します。

### Health Check

- **エンドポイント**：`GET /health`  
- **目的**：ランタイムが稼働しているかを確認し、バージョンやプロバイダステータスなどのメタ情報を取得する。  
- **用途**：ヘルスチェック、モニタリング、デプロイ後の手動確認など。  

### Agents

- **Agent 作成**  
  - **エンドポイント**：`POST /agents`  
  - **リクエストボディ**：Agent 定義（名前、説明、モデル、ツール、設定）。  
  - **レスポンス**：`agentId` を含む JSON オブジェクト。  
- **Agent 取得**  
  - **エンドポイント**：`GET /agents/{agentId}`  
  - **用途**：既存 Agent の設定を確認し、デバッグや監査に利用する。  

### Sessions

- **セッション作成**  
  - **エンドポイント**：`POST /agents/{agentId}/sessions`  
  - **リクエストボディ**：任意の `userId` と `metadata`。  
  - **レスポンス**：セッション ID を含むオブジェクト。  
- **関係**：1 つのセッションは 1 つの Agent に属し、1 つの Agent は複数のセッションを持つことができます。  

### Messages

- **非ストリーミングメッセージ送信**  
  - **エンドポイント**：`POST /agents/{agentId}/sessions/{sessionId}/messages`  
  - **クエリ**：`stream` なし、または `stream=false`。  
  - **リクエストボディ**：`role` と `content` を含むメッセージ。  
  - **レスポンス**：`messageId`、`content`、`toolCalls`、`usage`、`state` などを含む JSON。  
- **ストリーミングメッセージ送信**  
  - **エンドポイント**：`POST /agents/{agentId}/sessions/{sessionId}/messages?stream=true`  
  - **レスポンス**：Server-Sent Events（SSE）による逐次的な出力。  

Quickstart ページでは、これらのエンドポイントを用いた最小限の呼び出しシーケンスを紹介しています。

### Tools

- **ツールの有効化/無効化**  
  - **エンドポイント**：`PATCH /agents/{agentId}/tools/{toolName}`  
  - **リクエストボディ**：`{ "enabled": true | false }`  
  - **レスポンス**：ツール名、現在の状態、全ツールリストを含むオブジェクト。  

ツールを用いたワークフローや、動的なツールオン/オフを紹介する高度なガイドで特に重要です。

## 設定の概要

本ページでは具体的なデプロイ構成には踏み込みませんが、以下を前提とします：

- ランタイムの設定は `config/default.yaml` などのファイルに保持される。  
- プロバイダの認証情報とエンドポイントは `.env` に定義された環境変数から注入される。  
- `.env.example` にはサポートされるすべてのプロバイダ用変数が記載され、必須/任意がコメントで区別されている。  

設定内容と環境変数、安全な取り扱い方法を一箇所で確認したい場合は **Configuration & Security Practices** ページを参照してください。プロバイダごとの能力差や設定フィールドを比較したい場合は **プロバイダマトリクス** ページを参照してください。
